// const contactList = [
//   {
//       "userID": "2",
//       "contactID": "4",
//       "FirstName": "Real",
//       "LastName": "Person",
//       "Email": "anemail@gmail.com",
//       "Phone": "123-456-7890",
//       "Address": "Mars",
//       "Status": "Human",
//       "DateCreated": "2022-08-30 20:29:33"
//     },
//     {
//       "userID": "2",
//       "contactID": "6",
//       "FirstName": "Bruce",
//       "LastName": "Wayne",
//       "Email": "Bruce_wayne@waynetech.com",
//       "Phone": "148-782-3789",
//       "Address": "Wayne Manor, Gotham",
//       "Status": "Is Totally Batman",
//       "DateCreated": "2022-09-07 22:13:25"
//     },
//     {
//       "userID": "2",
//       "contactID": "7",
//       "FirstName": "Clark",
//       "LastName": "Kent",
//       "Email": "Clark_Kent@dailyplanet.com",
//       "Phone": "893-836-9362",
//       "Address": "Daily Planet Metropolis",
//       "Status": "Not Superman",
//       "DateCreated": "2022-09-07 22:16:29"
//     },
//     {
//       "userID": "1",
//       "contactID": "1",
//       "FirstName": "Harry",
//       "LastName": "Potter",
//       "Email": "harrypotter@gmail.wiz",
//       "Phone": "999-123-4567",
//       "Address": "7 Magical Ave, London",
//       "Status": "Friend",
//       "DateCreated": "2022-08-30 20:29:27"
//     },
//     {
//       "userID": "1",
//       "contactID": "2",
//       "FirstName": "Thomas",
//       "LastName": "Riddle",
//       "Email": "triddle@gmail.wiz",
//       "Phone": "666-123-4567",
//       "Address": "79 Evil Ave, London",
//       "Status": "Enemy",
//       "DateCreated": "2022-08-30 20:29:27"
//     },
//     {
//       "userID": "1",
//       "contactID": "3",
//       "FirstName": "Margot",
//       "LastName": "Robbie",
//       "Email": "margotrobbie@barbie.com",
//       "Phone": "332-445-6759",
//       "Address": "42 Sherman Wallaby Way",
//       "Status": "Friend",
//       "DateCreated": "2022-08-30 20:29:28"
//     },
//     {
//       "userID": "2",
//       "contactID": "4",
//       "FirstName": "Real",
//       "LastName": "Person",
//       "Email": "anemail@gmail.com",
//       "Phone": "123-456-7890",
//       "Address": "Mars",
//       "Status": "Human",
//       "DateCreated": "2022-08-30 20:29:33"
//     },
//     {
//       "userID": "2",
//       "contactID": "6",
//       "FirstName": "Bruce",
//       "LastName": "Wayne",
//       "Email": "Bruce_wayne@waynetech.com",
//       "Phone": "148-782-3789",
//       "Address": "Wayne Manor, Gotham",
//       "Status": "Is Totally Batman",
//       "DateCreated": "2022-09-07 22:13:25"
//     },
//     {
//       "userID": "2",
//       "contactID": "7",
//       "FirstName": "Clark",
//       "LastName": "Kent",
//       "Email": "Clark_Kent@dailyplanet.com",
//       "Phone": "893-836-9362",
//       "Address": "Daily Planet Metropolis",
//       "Status": "Not Superman",
//       "DateCreated": "2022-09-07 22:16:29"
//     },
//     {
//       "userID": "1",
//       "contactID": "1",
//       "FirstName": "Harry",
//       "LastName": "Potter",
//       "Email": "harrypotter@gmail.wiz",
//       "Phone": "999-123-4567",
//       "Address": "7 Magical Ave, London",
//       "Status": "Friend",
//       "DateCreated": "2022-08-30 20:29:27"
//     },
//     {
//       "userID": "1",
//       "contactID": "2",
//       "FirstName": "Thomas",
//       "LastName": "Riddle",
//       "Email": "triddle@gmail.wiz",
//       "Phone": "666-123-4567",
//       "Address": "79 Evil Ave, London",
//       "Status": "Enemy",
//       "DateCreated": "2022-08-30 20:29:27"
//     },
//     {
//       "userID": "1",
//       "contactID": "3",
//       "FirstName": "Margot",
//       "LastName": "Robbie",
//       "Email": "margotrobbie@barbie.com",
//       "Phone": "332-445-6759",
//       "Address": "42 Sherman Wallaby Way",
//       "Status": "Friend",
//       "DateCreated": "2022-08-30 20:29:28"
//     },
//     {
//       "userID": "2",
//       "contactID": "4",
//       "FirstName": "Real",
//       "LastName": "Person",
//       "Email": "anemail@gmail.com",
//       "Phone": "123-456-7890",
//       "Address": "Mars",
//       "Status": "Human",
//       "DateCreated": "2022-08-30 20:29:33"
//     },
//     {
//       "userID": "2",
//       "contactID": "6",
//       "FirstName": "Bruce",
//       "LastName": "Wayne",
//       "Email": "Bruce_wayne@waynetech.com",
//       "Phone": "148-782-3789",
//       "Address": "Wayne Manor, Gotham",
//       "Status": "Is Totally Batman",
//       "DateCreated": "2022-09-07 22:13:25"
//     },
//     {
//       "userID": "2",
//       "contactID": "7",
//       "FirstName": "Clark",
//       "LastName": "Kent",
//       "Email": "Clark_Kent@dailyplanet.com",
//       "Phone": "893-836-9362",
//       "Address": "Daily Planet Metropolis",
//       "Status": "Not Superman",
//       "DateCreated": "2022-09-07 22:16:29"
//     },
//     {
//       "userID": "1",
//       "contactID": "1",
//       "FirstName": "Harry",
//       "LastName": "Potter",
//       "Email": "harrypotter@gmail.wiz",
//       "Phone": "999-123-4567",
//       "Address": "7 Magical Ave, London",
//       "Status": "Friend",
//       "DateCreated": "2022-08-30 20:29:27"
//     },
//     {
//       "userID": "1",
//       "contactID": "2",
//       "FirstName": "Thomas",
//       "LastName": "Riddle",
//       "Email": "triddle@gmail.wiz",
//       "Phone": "666-123-4567",
//       "Address": "79 Evil Ave, London",
//       "Status": "Enemy",
//       "DateCreated": "2022-08-30 20:29:27"
//     },
//     {
//       "userID": "1",
//       "contactID": "3",
//       "FirstName": "Margot",
//       "LastName": "Robbie",
//       "Email": "margotrobbie@barbie.com",
//       "Phone": "332-445-6759",
//       "Address": "42 Sherman Wallaby Way",
//       "Status": "Friend",
//       "DateCreated": "2022-08-30 20:29:28"
//     },
//     {
//       "userID": "2",
//       "contactID": "4",
//       "FirstName": "Real",
//       "LastName": "Person",
//       "Email": "anemail@gmail.com",
//       "Phone": "123-456-7890",
//       "Address": "Mars",
//       "Status": "Human",
//       "DateCreated": "2022-08-30 20:29:33"
//     },
//     {
//       "userID": "2",
//       "contactID": "6",
//       "FirstName": "Bruce",
//       "LastName": "Wayne",
//       "Email": "Bruce_wayne@waynetech.com",
//       "Phone": "148-782-3789",
//       "Address": "Wayne Manor, Gotham",
//       "Status": "Is Totally Batman",
//       "DateCreated": "2022-09-07 22:13:25"
//     },
//     {
//       "userID": "2",
//       "contactID": "7",
//       "FirstName": "Clark",
//       "LastName": "Kent",
//       "Email": "Clark_Kent@dailyplanet.com",
//       "Phone": "893-836-9362",
//       "Address": "Daily Planet Metropolis",
//       "Status": "Not Superman",
//       "DateCreated": "2022-09-07 22:16:29"
//     },
//     {
//       "userID": "1",
//       "contactID": "1",
//       "FirstName": "Harry",
//       "LastName": "Potter",
//       "Email": "harrypotter@gmail.wiz",
//       "Phone": "999-123-4567",
//       "Address": "7 Magical Ave, London",
//       "Status": "Friend",
//       "DateCreated": "2022-08-30 20:29:27"
//     },
//     {
//       "userID": "1",
//       "contactID": "2",
//       "FirstName": "Thomas",
//       "LastName": "Riddle",
//       "Email": "triddle@gmail.wiz",
//       "Phone": "666-123-4567",
//       "Address": "79 Evil Ave, London",
//       "Status": "Enemy",
//       "DateCreated": "2022-08-30 20:29:27"
//     },
//     {
//       "userID": "1",
//       "contactID": "3",
//       "FirstName": "Margot",
//       "LastName": "Robbie",
//       "Email": "margotrobbie@barbie.com",
//       "Phone": "332-445-6759",
//       "Address": "42 Sherman Wallaby Way",
//       "Status": "Friend",
//       "DateCreated": "2022-08-30 20:29:28"
//     }
// ]

let contactList = [];
let page = 1;
let currentContactID = "";

fetch(`http://159.223.173.36/api/index.php/contacts?id=${localStorage.getItem('userID')}&page=${page}`)
  .then(response => response.json())
  .then(data => {
    contactList = data;
    const listItems = data.map( (element) => {

      return (
      `<div onclick="getContact(this)">
          <li class='flex cursor-pointer hover:bg-white'">
              <img
                  class="w-10 h-10 rounded-[50%] my-5 mx-3"
                  src=${profilePic}
              /> 
              <div class='my-5'>
                  <div class='flex max-w-[50%]'>
                      <p class="pr-2">${element.FirstName}</p>
                      <p>${element.LastName}</p>
                  </div>
                  <p class="text-gray-600">
                      ${element.Status}
                  </p>
              </div>
          </li>
          
          <hr class= 'bg-gray-300'>
          <p id='id' class='hidden'>${element.contactID}</p>
      </div>
      `
      )
    });
    list.innerHTML = listItems.join("");
  })
  .catch(e => console.log(e))

const profilePic = "https://as1.ftcdn.net/v2/jpg/03/53/11/00/1000_F_353110097_nbpmfn9iHlxef4EDIhXB1tdTD0lcWhG9.jpg"
const list = document.getElementById("contact-list");

function getContact(e){
  const id = e.lastElementChild.innerHTML;
  currentContactID = id;
  console.log(currentContactID)
  
  const contactData = contactList.filter(c => c.contactID == id)[0];

  const name = document.getElementById("name");
  name.innerHTML = contactData.FirstName;

  const lastName = document.getElementById("last");
  lastName.innerHTML = contactData.LastName;

  const status = document.getElementById("status");
  status.innerHTML = contactData.Status;

  const email = document.getElementById("email");
  email.innerHTML = contactData.Email;

  const phone = document.getElementById("phone");
  phone.innerHTML = contactData.Phone;

  const address = document.getElementById("address");
  address.innerHTML = contactData.Address;
}

const Delete = document.getElementById("delete");

Delete.addEventListener("click", (e) => {

    e.preventDefault();

    fetch(`/api/index.php/contacts/${currentContactID}`, {
        method: "DELETE",
        headers: {
          'Content-Type': 'application/json'
        }
    })
        .then(response => response.json())
        .then(data =>{
          console.log(data)
            if (data === "Contacts deleted successfully") {
                window.location.replace("http://contactsplus.xyz/homePage.html");
            }
        })
        .catch(e => console.log(e));
})

const Edit = document.getElementById("edit")

Edit.addEventListener("click", (e) => {

  e.preventDefault();

  let firstname = document.getElementById("name");
  let lastname = document.getElementById("last");
  let Status = document.getElementById("status");
  let Email = document.getElementById("email");
  let Phone = document.getElementById("phone");
  let Address = document.getElementById("address");

  firstname.contentEditable = true;
  lastname.contentEditable = true;
  Phone.contentEditable = true;
  Email.contentEditable = true;
  Status.contentEditable = true;
  Address.contentEditable = true;

})

const done = document.getElementById('done');
done.addEventListener("click", (e) => {

  e.preventDefault();

  const FirstName = document.getElementById("name").innerHTML;
  const LastName = document.getElementById("last").innerHTML;
  const Status = document.getElementById("status").innerText;
  const Email = document.getElementById("email").innerText;
  const Phone = document.getElementById("phone").innerText;
  const Address = document.getElementById("address").innerText;

  const contactData = {FirstName, LastName, Status, Email, Phone, Address};
  console.log(contactData)


  fetch(`/api/index.php/contacts/${currentContactID}`, {
      method: "PATCH",
      body: JSON.stringify(contactData)
  })
      .then(response => response.json())
      .then(data =>{
          if (data === "Contacts updated successfully") {
            window.location.replace("http://contactsplus.xyz/homePage.html");
          }
      })
      .catch(e => console.log(e));

})

let searchbar = document.getElementById("search-bar");

searchbar.addEventListener("keyup", (e) =>{

  e.preventDefault();
  list.innerHTML = '';
  let uri = `http://159.223.173.36/api/index.php/contacts?id=${localStorage.getItem('userID')}&page=${page}`;

  const values = document.getElementById("search-bar").value.split(" ");
  console.log(values)
  const firstName = values[0];
  const lastName = values[1];

  if(firstName !== undefined && firstName !== ""){
    uri += `&FirstName=${firstName}`;
  }

  if(lastName !== undefined && lastName !== ""){
    uri += `&LastName=${values[1]}`;
  }

  fetch(uri)
  .then(response => response.json())
  .then(data => {
    const listItems = data.map( (element) => {

      return (
      `<div onclick="getContact(this)">
          <li class='flex cursor-pointer hover:bg-white'">
              <img
                  class="w-10 h-10 rounded-[50%] my-5 mx-3"
                  src=${profilePic}
              /> 
              <div class='my-5'>
                  <div class='flex max-w-[50%]'>
                      <p class="pr-2">${element.FirstName}</p>
                      <p>${element.LastName}</p>
                  </div>
                  <p class="text-gray-600">
                      ${element.Status}
                  </p>
              </div>
          </li>
          
          <hr class= 'bg-gray-300'>
          <p id='id' class='hidden'>${element.contactID}</p>
      </div>
      `
      )
    });
    list.innerHTML = listItems.join("");
  })
  .catch(e => console.log(e))
})
